<!DOCTYPE html>
<html lang="en">

  <head>
    
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Tristan Britt


  | Crystallisation

</title>
<meta name="description" content="Based on [*folio](https://github.com/bogoli/-folio) design.
">

<!-- Open Graph -->

<meta property="og:site_name" content="Based on [*folio](https://github.com/bogoli/-folio) design.
" />
<meta property="og:type" content="object" />
<meta property="og:title" content="" />
<meta property="og:url" content="http://tbritt.xyz/projects/1_project/" />
<meta property="og:description" content="Crystallisation" />
<meta property="og:image" content="" />


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">
<!-- <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel="stylesheet"> -->
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->
<!-- 
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>/assets/img/favicon.ico</text></svg>">
 -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="http://tbritt.xyz/projects/1_project/">
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


<!-- Dark Mode -->
<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>


  </head>

  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="http://tbritt.xyz/">
       Tristan Britt
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          
          
          
          
          <li class="nav-item dropdown ">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                submenus
                
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
              
              
                <a class="dropdown-item" href="/publications/">publications</a>
              
              
              
                <div class="dropdown-divider"></div>
              
              
              
                <a class="dropdown-item" href="/projects/">projects</a>
              
              
              </div>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/teaching/">
                teaching
                
              </a>
          </li>
          
          
          
          
            <div class="toggle-container">
              <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">Crystallisation</h1>
    <p class="post-description">Simulation of 'Model C' phase transition</p>
  </header>

  <article>
    <p>The transition of a given solid material between regions of its phase diagram is a complicated phenomena to understand. Many attempts have been made over the years, with the first analytical description of transient behaviour of the system’s order parameter \(\varphi\) given by what is called ‘Model A’.</p>

<p>In this model, we consider non-conserving fields, where enthalpy gradients are the primary driving force in the transition across phase space. Consider a free energy functional with a \(\varphi^4\) potential that allows for two equilibrium phases. We can introduce a symetry breaking term \(\phi(\mathbf{x})\) that allows preferential occupation of a given state. We can write this free energy functional as:</p>

\[F[\varphi] = \int d\mathbf{x}\bigg(\frac{\varepsilon_\phi}{2}(\nabla\phi(\mathbf{x})^2)+H\{\underbrace{-\frac{1}{2}\phi^2(\mathbf{x})+\frac{1}{4}\phi^4(\mathbf{x})}_{g(\phi)}\}-\underbrace{B\phi(\mathbf{x})}_{f_b(\phi,B)}      \bigg)\]

<p>This simple model is essentially a sharp-interface model that can only describe macro- or meso-scale behaviour due to the interfacial coupling of the distinct faces across the interface. We can write the phase field equation in dimensionaless units as:</p>

\[\tau\frac{\partial\phi}{\partial t}=-\frac{\delta F}{\delta\phi} = -\frac{\varepsilon_\phi^2}{H}\nabla^2\phi - \frac{dg}{d\phi}-\frac{1}{H}\frac{\partial f_b}{\partial\phi}+\underbrace{\eta(\mathbf{x},t)}_\text{thermal noise}\]

<p>This non-conserved field takes only changes in chemical potential into account, but it does not include thermal affects, an obvious constraint of real crystallisation that must be considered.</p>

<p>We can begin to create more advanced theoretical frameworks. The code outlined here describes Model C, which posits that the changes to the order parameter are highly correlated to changes in the temperature field across various dendrites. It can furthermore include anisotropic tip growth to create fascinating patterns and beautiful patterns.</p>

<p>We can start to formulate a new construction of the phase parameter. In this case, we write the free energy as:</p>

\[F[\varphi] = \int d\mathbf{x}\bigg(\frac{\varepsilon^2_\phi}{2H}|\nabla\phi(\mathbf{x})^2|+g(\phi)-\lambda\frac{T-T_m}{L/c_p}P(\phi)      \bigg)\]

<p>where the final term is a similar symmetry breaking condition, related to the heat capacity and latent heat in the sample. We can write the coupled equations as:</p>

\[\tau\frac{\partial\phi}{\partial t}=-\frac{\delta F(\phi,T)}{\delta\phi}+\zeta(\mathbf{x},t)\]

\[\frac{\partial u}{\partial t} = \frac{k}{\rho c_p}\nabla^2u + \frac{1}{2}\frac{\partial P(\phi)}{\partial t}\]

<p>By seeding the order parameter, we propagate these equations to determine how the crystal structure will develop. By making the assumption that \(\varepsilon_\phi=\varepsilon_\phi(\mathbf{x})\), we can introduce anisotropy in the rate of dendrite growth. The example presented below includes 4-fold symmetry, where the rate of growth is dependent on the relative angle of the direction normal to the surface to the positive \(x\)-axis.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <picture>
    
    <source media="(max-width: 480px)" srcset="/assets/resized/1-480x480.jpg"></source>
    
    <source media="(max-width: 800px)" srcset="/assets/resized/1-800x800.jpg"></source>
    
    <source media="(max-width: 1400px)" srcset="/assets/resized/1-1400x1400.jpg"></source>
    
    <img class="img-fluid rounded z-depth-1" src="/assets/img/1.jpg" title="example image">
</picture>

    </div>
    <div class="col-sm mt-3 mt-md-0">
    </div>
</div>
<div class="caption">
   The order parameter of a characteristic material, with anisotropic surface tension that creates preferential dendritic growth.
</div>

<p>Owing to the complex computation of coupled partial derivatives given in the equations above, the simulation is computationally expensive. An array-optimised language is best to determine how the heat field will impact the order parameter. For efficiency, a <code class="language-plaintext highlighter-rouge">Fortran</code> script is included below that creates the data. It is written to include OpenMP optimisation, and it uses the <a href="https://raw.githubusercontent.com/MRedies/NPY-for-Fortran/master/src/npy.f90" target="_blank" rel="noopener noreferrer">m_npy</a> module to write the Fortran arrays into <a href="https://numpy.org" target="_blank" rel="noopener noreferrer">NumPy</a> arrays for visualisation.</p>

<div align="center" class="embed-responsive embed-responsive-4by3">
    <video autoplay="" controls="" loop="" class="embed-responsive-item">
        <source src="../../assets/video/test_anim.mp4" type="video/mp4"></source>
    </video>
</div>
<div class="caption">
   The order parameter $\varphi$ as a function of time time, starting with circular seed, including anisotropic tip growth.
</div>
<hr>
<p>Below is the Fortran script used to generate the data. Visualisation is done with <code class="language-plaintext highlighter-rouge">Python</code>, which created the <code class="language-plaintext highlighter-rouge">mp4</code> above.</p>

<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="k">PROGRAM</span><span class="w"> </span><span class="n">Crystallisation</span><span class="w">
    </span><span class="k">USE</span><span class="w"> </span><span class="n">mpi</span><span class="w">
    </span><span class="k">USE</span><span class="w"> </span><span class="n">omp_lib</span><span class="w">

    </span><span class="k">USE</span><span class="w"> </span><span class="n">m_npy</span><span class="w">
    </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="k">NONE</span><span class="w">

    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SELECTED_REAL_KIND</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="c1">! DECLARATIONS OF SIM PARAMS</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">h</span><span class="w"> 
    </span><span class="kt">LOGICAL</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">onBoundary</span><span class="p">,</span><span class="w"> </span><span class="n">file_exists</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">kk</span><span class="p">,</span><span class="w"> </span><span class="n">num_elem</span><span class="p">,</span><span class="w"> </span><span class="n">maxk</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="c1">! = 126*5; !N=800;</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">Im1_Jp1</span><span class="p">,</span><span class="w"> </span><span class="n">I_Jp1</span><span class="p">,</span><span class="w"> </span><span class="n">Ip1_Jp1</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">Im1_J</span><span class="p">,</span><span class="w">   </span><span class="n">I_J</span><span class="p">,</span><span class="w">   </span><span class="n">Ip1_J</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">Im1_Jm1</span><span class="p">,</span><span class="w"> </span><span class="n">I_Jm1</span><span class="p">,</span><span class="w"> </span><span class="n">Ip1_Jm1</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">edge</span><span class="p">(:)</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">x</span><span class="p">(:)</span><span class="w"> </span><span class="c1">!x=(0:h:(N+2)*h)';</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">y</span><span class="p">(:)</span><span class="w"> </span><span class="c1">!y=0:h:(N+2)*h;</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">phi</span><span class="p">(:,:),</span><span class="w"> </span><span class="n">phi0</span><span class="p">(:,:),</span><span class="w"> </span><span class="n">phi_next</span><span class="p">(:,:),</span><span class="w"> </span><span class="n">U</span><span class="p">(:,:),</span><span class="w"> </span><span class="n">tip_pos</span><span class="p">(:),</span><span class="w"> </span><span class="n">velocity</span><span class="p">(:)</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">eps4</span><span class="p">,</span><span class="w"> </span><span class="n">U0</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="c1">!degree of anisotropy, init temp, and slope of growth</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">as</span><span class="p">,</span><span class="w"> </span><span class="n">eps</span><span class="p">,</span><span class="w"> </span><span class="n">a12</span><span class="p">,</span><span class="w"> </span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">noise_coeff</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">y0</span><span class="p">,</span><span class="w"> </span><span class="n">r0</span><span class="p">;</span><span class="w"> </span><span class="c1">!seed center and radius</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">DERX_r</span><span class="p">,</span><span class="w"> </span><span class="n">DERX_l</span><span class="p">,</span><span class="w"> </span><span class="n">DERX_t</span><span class="p">,</span><span class="w"> </span><span class="n">DERX_b</span><span class="p">,</span><span class="w"> </span><span class="n">DERY_t</span><span class="p">,</span><span class="w"> </span><span class="n">DERY_r</span><span class="p">,</span><span class="w"> </span><span class="n">DERY_l</span><span class="p">,</span><span class="w"> </span><span class="n">DERY_b</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">MAG2_R</span><span class="p">,</span><span class="w"> </span><span class="n">A_R</span><span class="p">,</span><span class="w"> </span><span class="n">dA_R</span><span class="p">,</span><span class="w"> </span><span class="n">MAG2_L</span><span class="p">,</span><span class="w"> </span><span class="n">A_L</span><span class="p">,</span><span class="w"> </span><span class="n">dA_L</span><span class="p">,</span><span class="w"> </span><span class="n">MAG2_T</span><span class="p">,</span><span class="w"> </span><span class="n">A_T</span><span class="p">,</span><span class="w"> </span><span class="n">dA_T</span><span class="p">,</span><span class="w"> </span><span class="n">MAG2_B</span><span class="p">,</span><span class="w"> </span><span class="n">A_B</span><span class="p">,</span><span class="w"> </span><span class="n">dA_B</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">DERX</span><span class="p">,</span><span class="w"> </span><span class="n">DERY</span><span class="p">,</span><span class="w"> </span><span class="n">MAG2</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">JR</span><span class="p">,</span><span class="w"> </span><span class="n">JL</span><span class="p">,</span><span class="w"> </span><span class="n">JT</span><span class="p">,</span><span class="w"> </span><span class="n">JB</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">g_prime</span><span class="p">,</span><span class="w"> </span><span class="n">h_prime</span><span class="p">,</span><span class="w"> </span><span class="n">P_prime</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="w">

    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="c1">! DECLARATIONS of MPI</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ierr</span><span class="p">,</span><span class="w"> </span><span class="n">myrank</span><span class="p">,</span><span class="w"> </span><span class="n">nprocs</span><span class="p">,</span><span class="w"> </span><span class="nb">count</span><span class="p">,</span><span class="w"> </span><span class="n">remainder</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">idy</span><span class="p">,</span><span class="w"> </span><span class="n">nthread</span><span class="w">
    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">istart</span><span class="p">(:),</span><span class="w"> </span><span class="n">istop</span><span class="p">(:),</span><span class="w"> </span><span class="n">numElems</span><span class="p">(:),</span><span class="w"> </span><span class="n">recvcounts</span><span class="p">(:)</span><span class="w">
    </span><span class="kt">REAL</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">wtime</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="c1">! VARIABLES OF Model C</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="k">CALL</span><span class="w"> </span><span class="n">omp_set_num_threads</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w">
    </span><span class="n">nthread</span><span class="o">=</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="w">
    </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"Running on "</span><span class="p">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">int_to_char</span><span class="p">(</span><span class="n">nthread</span><span class="p">))//</span><span class="s2">" OpenMP threads."</span><span class="w">
    </span><span class="n">eps4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.06</span><span class="w">
    </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.19</span><span class="w">
    </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.4</span><span class="w">
    </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">126</span><span class="o">*</span><span class="mi">5</span><span class="w">
    </span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1-3</span><span class="o">*</span><span class="n">eps4</span><span class="p">;</span><span class="w"> </span><span class="n">eps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">eps4</span><span class="p">/</span><span class="n">as</span><span class="p">;</span><span class="w"> </span><span class="n">a12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="o">*</span><span class="n">as</span><span class="o">*</span><span class="n">eps</span><span class="p">;</span><span class="w"> </span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">;</span><span class="w"> 
    </span><span class="n">a1</span><span class="o">=</span><span class="mf">0.8836</span><span class="p">;</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.6267</span><span class="p">;</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a2</span><span class="o">*</span><span class="n">lambda</span><span class="p">;</span><span class="w">
    
    </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">/</span><span class="n">D</span><span class="w">
    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="o">*</span><span class="n">dt</span><span class="p">/(</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="w">
    </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3000</span><span class="w">
    </span><span class="n">maxk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CEILING</span><span class="p">(</span><span class="n">T</span><span class="p">/</span><span class="n">dt</span><span class="p">)</span><span class="w">
    </span><span class="n">noise_coeff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">/</span><span class="mi">1500</span><span class="o">*</span><span class="mf">0.1</span><span class="w">

    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="c1">! Seed and initial params</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="k">CALL</span><span class="w"> </span><span class="n">MPI_Init</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">MPI_Comm_rank</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="n">myrank</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span><span class="w">
    </span><span class="k">call</span><span class="w"> </span><span class="n">MPI_Comm_size</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="n">nprocs</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span><span class="w">
    </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI_Wtime</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w">

    </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">'(5x, a21)'</span><span class="p">,</span><span class="w"> </span><span class="n">advance</span><span class="o">=</span><span class="s2">"no"</span><span class="p">)</span><span class="w"> </span><span class="s2">"Allocating arrays ..."</span><span class="w">
    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="mi">+2</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="mi">+2</span><span class="p">))</span><span class="w">
    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+2</span><span class="p">),</span><span class="w"> </span><span class="n">phi0</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+2</span><span class="p">),</span><span class="w"> </span><span class="n">phi_next</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+2</span><span class="p">),</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+2</span><span class="p">))</span><span class="w">
    </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"> </span><span class="n">y0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"> </span><span class="n">r0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="o">*</span><span class="n">h</span><span class="p">;</span><span class="w">
    </span><span class="n">U0</span><span class="o">=</span><span class="mf">0.7</span><span class="w">
    </span><span class="n">U</span><span class="o">=-</span><span class="n">U0</span><span class="w">
</span><span class="c1">!dir$ loop count min(256)</span><span class="w">
    </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+2</span><span class="w">
        </span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">*</span><span class="n">h</span><span class="w">
        </span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">*</span><span class="n">h</span><span class="w">
        </span><span class="n">edge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w">
    </span><span class="k">ENDDO</span><span class="w">
    </span><span class="n">phi_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.d0</span><span class="w">
</span><span class="c1">!dir$ loop count min(256)</span><span class="w">
    </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+2</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+2</span><span class="w">
            </span><span class="n">phi0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">tanh</span><span class="p">((</span><span class="n">dsqrt</span><span class="p">((</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">y0</span><span class="p">))</span><span class="o">-</span><span class="n">r0</span><span class="p">)/</span><span class="n">dsqrt</span><span class="p">(</span><span class="mf">2.0_dp</span><span class="p">))</span><span class="w">
        </span><span class="k">ENDDO</span><span class="w">
    </span><span class="k">ENDDO</span><span class="w">
    </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">'(5x, a5)'</span><span class="p">)</span><span class="w"> </span><span class="s2">"DONE"</span><span class="w">
    </span><span class="n">phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi0</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="c1">! Main time loop</span><span class="w">
    </span><span class="c1">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w">
    </span><span class="nb">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">/</span><span class="n">nprocs</span><span class="w">
    </span><span class="n">remainder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MOD</span><span class="p">((</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nprocs</span><span class="p">)</span><span class="w">
    
    </span><span class="k">open</span><span class="w"> </span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">carriagecontrol</span><span class="o">=</span><span class="s1">'fortran'</span><span class="p">)</span><span class="w">
    </span><span class="k">DO</span><span class="w"> </span><span class="n">kk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">maxk</span><span class="w">
        </span><span class="c1">!main grid loop</span><span class="w">
        </span><span class="c1">!Boundary conditions (flux absorbing U(N+1)=U(N)+q*dx etc</span><span class="w">
        </span><span class="c1">!!mirror boundary conditions on phi</span><span class="w">
        </span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="mi">2</span><span class="p">,:);</span><span class="w"> 
        </span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="mi">+1</span><span class="p">,:);</span><span class="w"> 
        </span><span class="n">U</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span><span class="w"> 
        </span><span class="n">U</span><span class="p">(:,</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(:,</span><span class="n">N</span><span class="mi">+1</span><span class="p">);</span><span class="w">
        </span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">U</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="o">=</span><span class="n">U</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="mi">+1</span><span class="p">);</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="mi">+1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="o">=</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="mi">+1</span><span class="p">,</span><span class="n">N</span><span class="mi">+1</span><span class="p">);</span><span class="w">
        </span><span class="n">phi</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="mi">2</span><span class="p">,:);</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="mi">+1</span><span class="p">,:);</span><span class="w"> </span><span class="n">phi</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">phi</span><span class="p">(:,</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(:,</span><span class="n">N</span><span class="mi">+1</span><span class="p">);</span><span class="w">
        </span><span class="n">phi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">phi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="o">=</span><span class="n">phi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="mi">+1</span><span class="p">);</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="mi">+1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="mi">+2</span><span class="p">,</span><span class="n">N</span><span class="mi">+2</span><span class="p">)</span><span class="o">=</span><span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="mi">+1</span><span class="p">,</span><span class="n">N</span><span class="mi">+1</span><span class="p">);</span><span class="w">

</span><span class="c1">!$omp parallel do schedule(guided) default(shared) private(i, j)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+1</span><span class="w">
            </span><span class="k">DO</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+1</span><span class="w">
                </span><span class="c1">!define derivative on edges of finite volume in x</span><span class="w">
                </span><span class="n">DERX_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span><span class="w"> </span><span class="n">DERX_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w">
                </span><span class="n">DERX_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">+</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="w">
                </span><span class="n">DERX_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">))</span><span class="w">
                
                </span><span class="c1">!same in y</span><span class="w">
                </span><span class="n">DERY_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span><span class="w"> </span><span class="n">DERY_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">)</span><span class="w">
                </span><span class="n">DERY_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">)</span><span class="o">+</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">))</span><span class="w">
                </span><span class="n">DERY_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">)</span><span class="o">+</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">))</span><span class="w">
                
                </span><span class="c1">!anisotropy</span><span class="w">
                </span><span class="n">MAG2_R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DERX_r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DERY_r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span><span class="w">
                </span><span class="k">IF</span><span class="p">(</span><span class="n">MAG2_R</span><span class="ow">.le.</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
                    </span><span class="n">A_R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="p">;</span><span class="w"> </span><span class="n">dA_R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
                </span><span class="k">ELSE</span><span class="w">
                    </span><span class="n">A_R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eps</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_r</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="n">DERY_r</span><span class="o">**</span><span class="mi">4</span><span class="p">)/</span><span class="n">MAG2_R</span><span class="p">);</span><span class="w"> </span><span class="n">dA_R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">a12</span><span class="o">*</span><span class="n">DERX_r</span><span class="o">*</span><span class="n">DERY_r</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_r</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">DERY_r</span><span class="o">**</span><span class="mi">2</span><span class="p">)/</span><span class="n">MAG2_R</span><span class="p">;</span><span class="w">
                </span><span class="k">ENDIF</span><span class="w">
                
                </span><span class="n">MAG2_L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DERX_l</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DERY_l</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span><span class="w">
                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">MAG2_L</span><span class="ow">.le.</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
                    </span><span class="n">A_L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="p">;</span><span class="w"> </span><span class="n">dA_L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
                </span><span class="k">ELSE</span><span class="w">
                    </span><span class="n">A_L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eps</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_l</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="n">DERY_l</span><span class="o">**</span><span class="mi">4</span><span class="p">)/</span><span class="n">MAG2_L</span><span class="p">);</span><span class="w"> </span><span class="n">dA_L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">a12</span><span class="o">*</span><span class="n">DERX_l</span><span class="o">*</span><span class="n">DERY_l</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_l</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">DERY_l</span><span class="o">**</span><span class="mi">2</span><span class="p">)/</span><span class="n">MAG2_L</span><span class="p">;</span><span class="w">
                </span><span class="k">ENDIF</span><span class="w">
                
                </span><span class="n">MAG2_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DERX_t</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DERY_t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span><span class="w">
                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">MAG2_T</span><span class="ow">.le.</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
                    </span><span class="n">A_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="p">;</span><span class="w"> </span><span class="n">dA_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
                </span><span class="k">ELSE</span><span class="w">
                    </span><span class="n">A_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eps</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_t</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="n">DERY_t</span><span class="o">**</span><span class="mi">4</span><span class="p">)/</span><span class="n">MAG2_T</span><span class="p">);</span><span class="w"> </span><span class="n">dA_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">a12</span><span class="o">*</span><span class="n">DERX_t</span><span class="o">*</span><span class="n">DERY_t</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_t</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">DERY_t</span><span class="o">**</span><span class="mi">2</span><span class="p">)/</span><span class="n">MAG2_T</span><span class="p">;</span><span class="w">
                </span><span class="k">ENDIF</span><span class="w">     
                
                </span><span class="n">MAG2_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DERX_b</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DERY_b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span><span class="w">
                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">MAG2_B</span><span class="ow">.le.</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
                    </span><span class="n">A_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="p">;</span><span class="w"> </span><span class="n">dA_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
                </span><span class="k">ELSE</span><span class="w">
                    </span><span class="n">A_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eps</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_b</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="n">DERY_b</span><span class="o">**</span><span class="mi">4</span><span class="p">)/</span><span class="n">MAG2_B</span><span class="p">);</span><span class="w"> </span><span class="n">dA_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">a12</span><span class="o">*</span><span class="n">DERX_b</span><span class="o">*</span><span class="n">DERY_b</span><span class="o">*</span><span class="p">(</span><span class="n">DERX_b</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">DERY_b</span><span class="o">**</span><span class="mi">2</span><span class="p">)/</span><span class="n">MAG2_B</span><span class="p">;</span><span class="w">
                </span><span class="k">ENDIF</span><span class="w">
                
                </span><span class="n">DERX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="p">));</span><span class="w"> </span><span class="n">DERY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">));</span><span class="w"> 
                </span><span class="n">MAG2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DERX</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DERY</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span><span class="w">
                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">MAG2</span><span class="ow">.le.</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
                    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="p">;</span><span class="w">
                </span><span class="k">ELSE</span><span class="w">
                    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eps</span><span class="o">*</span><span class="p">(</span><span class="n">DERX</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="n">DERY</span><span class="o">**</span><span class="mi">4</span><span class="p">)/</span><span class="n">MAG2</span><span class="p">);</span><span class="w">
                </span><span class="k">ENDIF</span><span class="w">
                
                </span><span class="c1">!define fluxes at each side of the finite volume</span><span class="w">
                </span><span class="n">JR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_R</span><span class="o">*</span><span class="p">(</span><span class="n">A_R</span><span class="o">*</span><span class="n">DERX_r</span><span class="o">-</span><span class="n">dA_R</span><span class="o">*</span><span class="n">DERY_r</span><span class="p">);</span><span class="w"> </span><span class="n">JL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_L</span><span class="o">*</span><span class="p">(</span><span class="n">A_L</span><span class="o">*</span><span class="n">DERX_l</span><span class="o">-</span><span class="n">dA_L</span><span class="o">*</span><span class="n">DERY_l</span><span class="p">);</span><span class="w">
                </span><span class="n">JT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_T</span><span class="o">*</span><span class="p">(</span><span class="n">A_T</span><span class="o">*</span><span class="n">DERY_t</span><span class="o">+</span><span class="n">dA_T</span><span class="o">*</span><span class="n">DERX_t</span><span class="p">);</span><span class="w"> </span><span class="n">JB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_B</span><span class="o">*</span><span class="p">(</span><span class="n">A_B</span><span class="o">*</span><span class="n">DERY_b</span><span class="o">+</span><span class="n">dA_B</span><span class="o">*</span><span class="n">DERX_b</span><span class="p">);</span><span class="w">
                </span><span class="c1">!update phi</span><span class="w">
                </span><span class="n">g_prime</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="w">
                </span><span class="n">h_prime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
                </span><span class="n">P_prime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="w">
                
                </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">()</span><span class="w">
                </span><span class="n">phi_next</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="p">/(</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">JR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">JL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">JT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">JB</span><span class="p">)/(</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">g_prime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lambda</span><span class="o">*</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">P_prime</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="o">*</span><span class="n">noise</span><span class="w">
                </span><span class="c1">!ENDIF !if not on boudnary</span><span class="w">
            </span><span class="k">ENDDO</span><span class="w"> </span><span class="c1">!x</span><span class="w">
        </span><span class="k">ENDDO</span><span class="w"> </span><span class="c1">!y</span><span class="w">
</span><span class="c1">!$omp end parallel do</span><span class="w">

        </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+1</span><span class="w">
            </span><span class="k">DO</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="mi">+1</span><span class="w">
                </span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1-4</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="mi">-1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="mi">+1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="mi">+1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h_prime</span><span class="o">*</span><span class="p">(</span><span class="n">phi_next</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="w">
            </span><span class="k">ENDDO</span><span class="w">
        </span><span class="k">ENDDO</span><span class="w">

        </span><span class="n">phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi_next</span><span class="w">
        </span><span class="k">IF</span><span class="w"> </span><span class="p">((</span><span class="nb">mod</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="ow">.eq.</span><span class="mi">0</span><span class="p">)</span><span class="ow">.or.</span><span class="p">(</span><span class="n">kk</span><span class="ow">.eq.</span><span class="mi">1</span><span class="p">)</span><span class="ow">.or.</span><span class="p">(</span><span class="n">kk</span><span class="ow">.eq.</span><span class="n">maxk</span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span><span class="w">
            </span><span class="k">CALL</span><span class="w"> </span><span class="n">save_npy</span><span class="p">(</span><span class="s1">'data/Nt='</span><span class="p">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">int_to_char</span><span class="p">(</span><span class="n">kk</span><span class="p">))//</span><span class="s1">'.npy'</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="p">)</span><span class="w">
            </span><span class="k">CALL</span><span class="w"> </span><span class="n">save_npy</span><span class="p">(</span><span class="s1">'data/Nt='</span><span class="p">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">int_to_char</span><span class="p">(</span><span class="n">kk</span><span class="p">))//</span><span class="s1">'_U.npy'</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="w">
        </span><span class="k">ENDIF</span><span class="w">
        </span><span class="k">CALL</span><span class="w"> </span><span class="n">progress</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="n">maxk</span><span class="p">)</span><span class="w">
    </span><span class="k">ENDDO</span><span class="w"> </span><span class="c1">!kk</span><span class="w">
    </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI_Wtime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wtime</span><span class="w">
    </span><span class="k">CALL</span><span class="w"> </span><span class="n">MPI_Finalize</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span><span class="w">

    </span><span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
    </span><span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span><span class="w"> </span><span class="n">phi0</span><span class="p">,</span><span class="w"> </span><span class="n">phi_next</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="w">

    </span><span class="k">CONTAINS</span><span class="w">
        </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">rnorm_2D</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w">
        </span><span class="kt">REAL</span><span class="p">(</span><span class="n">DP</span><span class="p">),</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="k">INOUT</span><span class="p">),</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">arr</span><span class="p">(:,:)</span><span class="w">
        </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="w">
        
        </span><span class="k">DO</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="nb">LBOUND</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">UBOUND</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
            </span><span class="k">DO</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="nb">LBOUND</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nb">UBOUND</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w">
                </span><span class="n">arr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">()</span><span class="w">
            </span><span class="k">ENDDO</span><span class="w">
        </span><span class="k">ENDDO</span><span class="w">
        </span><span class="k">END</span><span class="w"> </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">rnorm_2D</span><span class="w">
        
        </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">rnorm</span><span class="p">()</span><span class="w"> </span><span class="k">RESULT</span><span class="p">(</span><span class="w"> </span><span class="n">fn_val</span><span class="w"> </span><span class="p">)</span><span class="w">

        </span><span class="c1">!   Generate a random normal deviate using the polar method.</span><span class="w">
        </span><span class="c1">!   Reference: Marsaglia,G. &amp; Bray,T.A. 'A convenient method for generating</span><span class="w">
        </span><span class="c1">!              normal variables', Siam Rev., vol.6, 260-264, 1964.</span><span class="w">

            </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="k">NONE</span><span class="w">
            </span><span class="kt">REAL</span><span class="p">(</span><span class="n">DP</span><span class="p">)</span><span class="w">  </span><span class="p">::</span><span class="w"> </span><span class="n">fn_val</span><span class="w">

            </span><span class="c1">! Local variables</span><span class="w">

            </span><span class="kt">REAL</span><span class="w">            </span><span class="p">::</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="nb">sum</span><span class="w">
            </span><span class="kt">REAL</span><span class="p">,</span><span class="w"> </span><span class="k">SAVE</span><span class="w">      </span><span class="p">::</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">sln</span><span class="w">
            </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w"> </span><span class="k">SAVE</span><span class="w">   </span><span class="p">::</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.FALSE.</span><span class="w">
            </span><span class="kt">REAL</span><span class="p">,</span><span class="w"> </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">vsmall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TINY</span><span class="p">(</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="p">)</span><span class="w">

            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
            </span><span class="c1">! If second, use the second random number generated on last call</span><span class="w">

              </span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.false.</span><span class="w">
              </span><span class="n">fn_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="n">sln</span><span class="w">

            </span><span class="k">ELSE</span><span class="w">
            </span><span class="c1">! First call; generate a pair of random normals</span><span class="w">

              </span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.true.</span><span class="w">
              </span><span class="k">DO</span><span class="w">
                </span><span class="k">CALL</span><span class="w"> </span><span class="nb">RANDOM_NUMBER</span><span class="p">(</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="p">)</span><span class="w">
                </span><span class="k">CALL</span><span class="w"> </span><span class="nb">RANDOM_NUMBER</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span><span class="w">
                </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SCALE</span><span class="p">(</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">one</span><span class="w">
                </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SCALE</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">one</span><span class="w">
                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="o">*</span><span class="n">u</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vsmall</span><span class="w">         </span><span class="c1">! vsmall added to prevent LOG(zero) / zero</span><span class="w">
                </span><span class="k">IF</span><span class="p">(</span><span class="nb">sum</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">one</span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span><span class="w">
              </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w">
              </span><span class="n">sln</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="nb">SCALE</span><span class="p">(</span><span class="w"> </span><span class="nb">LOG</span><span class="p">(</span><span class="nb">sum</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="nb">sum</span><span class="p">)</span><span class="w">
              </span><span class="n">fn_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="o">*</span><span class="n">sln</span><span class="w">
            </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="w">

            </span><span class="k">RETURN</span><span class="w">
        </span><span class="k">END</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">rnorm</span><span class="w">
        
        </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">IJ2N</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">)</span><span class="w"> </span><span class="k">RESULT</span><span class="p">(</span><span class="w"> </span><span class="n">fn_val</span><span class="w"> </span><span class="p">)</span><span class="w">
            </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="k">NONE</span><span class="w">
            </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="k">IN</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">nn</span><span class="w">
            </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">fn_val</span><span class="w">
            
            </span><span class="n">fn_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">*</span><span class="n">nn</span><span class="o">+</span><span class="n">j</span><span class="w">
            
        </span><span class="k">END</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">IJ2N</span><span class="w">
        
        </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">N2IJ</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nn</span><span class="p">)</span><span class="w"> </span><span class="k">RESULT</span><span class="p">(</span><span class="w"> </span><span class="n">fn_val</span><span class="w"> </span><span class="p">)</span><span class="w">
            </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="k">NONE</span><span class="w">
            </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="k">IN</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nn</span><span class="w">
            </span><span class="kt">INTEGER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">fn_val</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="w">
            
            </span><span class="n">fn_val</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="n">nn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
            </span><span class="n">fn_val</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nn</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
            
        </span><span class="k">END</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">N2IJ</span><span class="w">
        
        
        </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">progress</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">jmax</span><span class="p">)</span><span class="w">
          </span><span class="k">implicit</span><span class="w"> </span><span class="k">none</span><span class="w">
          </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">4</span><span class="p">)::</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">jmax</span><span class="w">
          </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">67</span><span class="p">)::</span><span class="n">bar</span><span class="o">=</span><span class="s2">"??????/?????? - ???% |                                                           |"</span><span class="w">
          </span><span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">bar</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s2">"(i6)"</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w">
          </span><span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">bar</span><span class="p">(</span><span class="mi">7</span><span class="p">:</span><span class="mi">13</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s2">"(i6)"</span><span class="p">)</span><span class="w"> </span><span class="n">jmax</span><span class="w">
          </span><span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">bar</span><span class="p">(</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s2">"(i3)"</span><span class="p">)</span><span class="w"> </span><span class="mi">10</span><span class="o">*</span><span class="n">j</span><span class="p">/</span><span class="n">jmax</span><span class="w">
          </span><span class="k">do</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">/</span><span class="n">jmax</span><span class="w">
            </span><span class="n">bar</span><span class="p">(</span><span class="mi">6</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="s2">"*"</span><span class="w">
          </span><span class="k">enddo</span><span class="w">
          </span><span class="c1">! print the progress bar.</span><span class="w">
          </span><span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s2">"(a1,a1,a17)"</span><span class="p">)</span><span class="w"> </span><span class="s1">'+'</span><span class="p">,</span><span class="nb">char</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span><span class="w"> </span><span class="n">bar</span><span class="w">
          </span><span class="k">return</span><span class="w">
        </span><span class="k">END</span><span class="w"> </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">progress</span><span class="w">
        
        </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">int_to_char</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w">
            </span><span class="c1">!-----------------------------------------------------------------------</span><span class="w">
            </span><span class="c1">!! Converts an integer number of up to 6 figures into a left-justifed</span><span class="w">
            </span><span class="c1">!! character variable.</span><span class="w">
            </span><span class="c1">!</span><span class="w">
            </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="k">NONE</span><span class="w">
            </span><span class="c1">!</span><span class="w">
            </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="k">IN</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">i</span><span class="w">
            </span><span class="kt">CHARACTER</span><span class="w"> </span><span class="p">(</span><span class="nb">LEN</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="w">   </span><span class="p">::</span><span class="w"> </span><span class="n">int_to_char</span><span class="w">
            </span><span class="kt">CHARACTER</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">c</span><span class="w">
            </span><span class="kt">INTEGER</span><span class="w">   </span><span class="p">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">nc</span><span class="w">
            </span><span class="kt">LOGICAL</span><span class="w">   </span><span class="p">::</span><span class="w"> </span><span class="n">neg</span><span class="w">
            </span><span class="c1">!   </span><span class="w">
            </span><span class="n">nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w">
            </span><span class="c1">!</span><span class="w">
            </span><span class="k">IF</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">
               </span><span class="n">nc</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">
               </span><span class="n">n</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w">
               </span><span class="n">neg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.true.</span><span class="w">
            </span><span class="k">ELSE</span><span class="w">
               </span><span class="n">n</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w">
               </span><span class="n">neg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.false.</span><span class="w">
            </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="w">
            </span><span class="c1">!</span><span class="w">
            </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
            </span><span class="k">DO</span><span class="w"> </span><span class="k">WHILE</span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="p">)</span><span class="w"> 
               </span><span class="n">int_to_char</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ICHAR</span><span class="p">(</span><span class="w"> </span><span class="s1">'0'</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
               </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="mi">10</span><span class="w">
               </span><span class="k">IF</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span><span class="w">
               </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
            </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w">
            </span><span class="c1">!</span><span class="w">
            </span><span class="k">IF</span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
               </span><span class="k">DO</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">/</span><span class="mi">2</span><span class="w">
                  </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">int_to_char</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w">
                  </span><span class="n">int_to_char</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">int_to_char</span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">-</span><span class="n">n</span><span class="mi">+1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">j</span><span class="o">-</span><span class="n">n</span><span class="mi">+1</span><span class="w"> </span><span class="p">)</span><span class="w">
                  </span><span class="n">int_to_char</span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">-</span><span class="n">n</span><span class="mi">+1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">j</span><span class="o">-</span><span class="n">n</span><span class="mi">+1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w">
               </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w">
               </span><span class="k">IF</span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">int_to_char</span><span class="p">(</span><span class="n">j</span><span class="mi">+1</span><span class="p">:</span><span class="n">nc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">' '</span><span class="w">
            </span><span class="k">ELSE</span><span class="w">
               </span><span class="n">int_to_char</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'*'</span><span class="w">
            </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="w">
            </span><span class="c1">!</span><span class="w">
            </span><span class="k">IF</span><span class="p">(</span><span class="w"> </span><span class="n">neg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
               </span><span class="k">DO</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nc</span><span class="mi">+1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="w">
                  </span><span class="n">int_to_char</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">int_to_char</span><span class="p">(</span><span class="n">n</span><span class="mi">-1</span><span class="p">:</span><span class="n">n</span><span class="mi">-1</span><span class="p">)</span><span class="w">
               </span><span class="k">END</span><span class="w"> </span><span class="k">DO</span><span class="w">
               </span><span class="n">int_to_char</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'-'</span><span class="w">
            </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="w">
            </span><span class="c1">!</span><span class="w">
            </span><span class="k">RETURN</span><span class="w">
            </span><span class="c1">!</span><span class="w">
        </span><span class="k">END</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">int_to_char</span><span class="w">

</span><span class="k">END</span><span class="w"> </span><span class="k">PROGRAM</span><span class="w"> </span><span class="n">Crystallisation</span><span class="w">
</span></code></pre></div></div>


  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="sticky-bottom mt-5">
  <div class="container">
    <center>
    © Copyright 2023 Tristan L. Britt.
    Powered by <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>.

    
    
    Last updated: February 02, 2023.
    
  </center>
  </div>
</footer>



  </body>

  <!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>

  
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-XXXXXXXXX');
</script>






</html>
